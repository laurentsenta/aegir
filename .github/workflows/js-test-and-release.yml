# File managed by web3-bot. DO NOT EDIT.
# See https://github.com/protocol/.github/ for details.

name: test & maybe release
on:
  push:
    branches:
      - master
  pull_request:

jobs:

  test-node:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        # https://github.com/nodejs/node/issues/45013#issuecomment-1279761003
        os: [windows-latest, ubuntu-latest, macos-latest]
        # 18.12.1: https://github.com/ipfs/aegir/actions/runs/3702114083/jobs/6272053610
        # coverage disable in 14 dec: https://github.com/ipfs/aegir/pull/1137
        node: [16.1, 16.2, 16.19, 16, 17, 18.10.0, 18.0, 18.1, 18.5, 18.7, 18.14.2, lts/*, latest, ]
      fail-fast: false
    timeout-minutes: 20 # usually < 10 minutes (https://github.com/ipfs/aegir/actions/runs/3702114083/jobs/6272053610)
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node }}
      - uses: ipfs/aegir/actions/cache-node-modules@master
      - run: npm run --if-present test:node
      - uses: codecov/codecov-action@d9f34f8cd5cb3b3eb79b3e4b5dae3a16df499a70 # v3.1.1
        with:
          flags: node